# ‚úÖ Latihan PHP ‚Äì Aplikasi Todo List (CRUD + PostgreSQL)

Aplikasi Todo List sederhana menggunakan **PHP Native (tanpa framework)** dengan arsitektur **MVC sederhana** dan database **PostgreSQL**. Aplikasi ini memiliki fitur CRUD (Create, Read, Update, Delete) dan sudah menggunakan tampilan Bootstrap.

---

## üöÄ Teknologi yang Digunakan
| Komponen        | Versi / Teknologi |
|-----------------|-------------------|
| Bahasa Pemrograman | PHP 8.x |
| Database        | PostgreSQL 16 |
| Frontend        | Bootstrap 5.3 |
| Arsitektur      | MVC sederhana |
| Web Server      | PHP Built-in Server (`php -S`) |

---

## ‚öôÔ∏è Konfigurasi Database PostgreSQL

Buat database `db_todo`, lalu jalankan SQL berikut:

```sql
-- Ganti ke schema public
-- =============================================
-- UPGRADE DATABASE PHP TODO LIST (idempotent)
-- =============================================
SET search_path TO public;

-- STEP 0: Pastikan tabelnya ada
CREATE TABLE IF NOT EXISTS public.todo (
    id          INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    title       VARCHAR(250),
    is_finished BOOLEAN NOT NULL DEFAULT FALSE,
    description TEXT,
    sort_order  INT NOT NULL DEFAULT 0,
    created_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- STEP 1: Rename kolom lama jika memang masih ada
DO $$
BEGIN
    IF EXISTS (
        SELECT 1 FROM information_schema.columns
        WHERE table_schema='public' AND table_name='todo' AND column_name='activity'
    ) THEN
        EXECUTE 'ALTER TABLE public.todo RENAME COLUMN activity TO title';
    END IF;

    IF EXISTS (
        SELECT 1 FROM information_schema.columns
        WHERE table_schema='public' AND table_name='todo' AND column_name='status'
    ) THEN
        EXECUTE 'ALTER TABLE public.todo RENAME COLUMN status TO is_finished';
    END IF;
END $$;

-- STEP 2: Pastikan kolom-kolom ada (kalau belum, buat)
ALTER TABLE public.todo
    ADD COLUMN IF NOT EXISTS title       VARCHAR(250),
    ADD COLUMN IF NOT EXISTS is_finished BOOLEAN NOT NULL DEFAULT FALSE,
    ADD COLUMN IF NOT EXISTS description TEXT,
    ADD COLUMN IF NOT EXISTS sort_order  INT NOT NULL DEFAULT 0,
    ADD COLUMN IF NOT EXISTS created_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ADD COLUMN IF NOT EXISTS updated_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP;

-- STEP 3: (Opsional) Tambahkan kembali kolom `activity` untuk kompatibilitas
ALTER TABLE public.todo
    ADD COLUMN IF NOT EXISTS activity VARCHAR(250);

-- Isi activity dari title jika activity masih kosong
UPDATE public.todo
SET activity = title
WHERE (activity IS NULL OR activity = '')
  AND title IS NOT NULL;

-- STEP 4: Normalisasi tipe & constraint
ALTER TABLE public.todo
    ALTER COLUMN is_finished DROP DEFAULT,
    ALTER COLUMN is_finished TYPE boolean USING (CASE
        WHEN is_finished IS NULL THEN FALSE
        ELSE is_finished::boolean
    END),
    ALTER COLUMN is_finished SET DEFAULT FALSE;

-- title wajib diisi
ALTER TABLE public.todo
    ALTER COLUMN title SET NOT NULL;

-- Unik (case-insensitive) untuk title
DROP INDEX IF EXISTS todo_title_unique;
CREATE UNIQUE INDEX todo_title_unique ON public.todo (LOWER(title));

-- Urutan default = id untuk baris yang belum punya
UPDATE public.todo SET sort_order = id WHERE COALESCE(sort_order,0) = 0;

-- STEP 5: Trigger updated_at
CREATE OR REPLACE FUNCTION public.update_timestamp()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at := CURRENT_TIMESTAMP;
  RETURN NEW;
END; $$ LANGUAGE plpgsql;

DROP TRIGGER IF EXISTS update_todo_timestamp ON public.todo;
CREATE TRIGGER update_todo_timestamp
BEFORE UPDATE ON public.todo
FOR EACH ROW
EXECUTE FUNCTION public.update_timestamp();

-- STEP 6 (Opsional tapi direkomendasikan):
-- Sinkronkan title <-> activity agar kode lama yang masih pakai `activity` tetap jalan.
CREATE OR REPLACE FUNCTION public.sync_title_activity()
RETURNS TRIGGER AS $$
BEGIN
  -- Jika hanya activity yang diisi, salin ke title
  IF (NEW.title IS NULL OR NEW.title = '') AND (NEW.activity IS NOT NULL AND NEW.activity <> '') THEN
    NEW.title := NEW.activity;
  END IF;
  -- Jika title diubah, samakan activity
  IF (NEW.title IS NOT NULL AND NEW.title <> COALESCE(OLD.title, '')) THEN
    NEW.activity := NEW.title;
  END IF;
  RETURN NEW;
END; $$ LANGUAGE plpgsql;

DROP TRIGGER IF EXISTS sync_title_activity_biud ON public.todo;
CREATE TRIGGER sync_title_activity_biud
BEFORE INSERT OR UPDATE ON public.todo
FOR EACH ROW
EXECUTE FUNCTION public.sync_title_activity();


